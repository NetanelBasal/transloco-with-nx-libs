!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("flat"),require("rxjs/operators"),require("@angular/core"),require("rxjs")):"function"==typeof define&&define.amd?define("@ngneat/transloco",["exports","flat","rxjs/operators","@angular/core","rxjs"],t):t((e.ngneat=e.ngneat||{},e.ngneat.transloco={}),e.flat,e.rxjs.operators,e.ng.core,e.rxjs)}(this,function(e,t,c,n,p){"use strict";t=t&&t.hasOwnProperty("default")?t["default"]:t;var u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=a["return"])&&n.call(a)}finally{if(i)throw i.error}}return o}var d=(r.prototype.getTranslation=function(e){return p.of(this.translations.get(e)||{})},r);function r(e){this.translations=e}var i=new n.InjectionToken("TRANSLOCO_LOADER");function g(e,t){return e&&e.hasOwnProperty(t)?e[t]:t.split(".").reduce(function(e,t){return e&&e[t]},e)}function h(e,t,r){e=u({},e);var n=t.split("."),i=n.length-1;return n.reduce(function(e,t,n){return e[t]=n===i?r:Array.isArray(e[t])?e[t].slice():u({},e[t]),e&&e[t]},e),e}function a(e){return e?Array.isArray(e)?e.length:v(e)?Object.keys(e).length:e?e.length:0:0}function o(e){return"function"==typeof e}function f(e){return"string"==typeof e}function s(e){return"number"==typeof e}function v(e){return e&&"object"==typeof e&&!Array.isArray(e)}function y(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/\s+|_|-|\//g,"")}function L(){return"undefined"!=typeof window}function b(e){return null===e||e===undefined}function T(e){return!1===b(e)}function m(e){return e&&"string"==typeof e.scope}function S(e){return e&&v(e.loader)}function O(e){return t.unflatten(e,{safe:!0})}function C(e){return t(e,{safe:!0})}var A=new n.InjectionToken("TRANSLOCO_TRANSPILER"),w=(R.prototype.transpile=function(i,a,o){var s=this;return void 0===a&&(a={}),f(i)?i.replace(/{{(.*?)}}/g,function(e,t){return t=t.trim(),T(a[t])?a[t]:T(o[t])?o[t]:""}):(v(i)&&a&&Object.keys(a).forEach(function(e){var t=g(i,e),n=g(a,e),r=s.transpile(t,n,o);i=h(i,e,r)}),i)},R);function R(){}var j=new n.InjectionToken("TRANSLOCO_CONFIG",{providedIn:"root",factory:function(){return{}}}),I={defaultLang:"en",reRenderOnLangChange:!1,prodMode:!1,failedRetries:2,availableLangs:[],missingHandler:{useFallbackTranslation:!1,allowEmpty:!1},flatten:{aot:!1}},k=new n.InjectionToken("TRANSLOCO_MISSING_HANDLER"),N=(_.prototype.handle=function(e,t){if(!t.prodMode){var n="Missing translation for '"+e+"'";console.warn("%c "+n,"font-size: 12px; color: red")}return e},_);function _(){}var M=new n.InjectionToken("TRANSLOCO_INTERCEPTOR"),F=(E.prototype.preSaveTranslation=function(e,t){return e},E.prototype.preSaveTranslationKey=function(e,t,n){return t},E);function E(){}var P,D=new n.InjectionToken("TRANSLOCO_FALLBACK_STRATEGY"),x=(H.prototype.getNextLangs=function(e){var t=this.userConfig.fallbackLang;if(!t)throw new Error("When using the default fallback, a fallback language must be provided in the config!");return Array.isArray(t)?t:[t]},H.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Inject,args:[j]}]}]},H);function H(e){this.userConfig=e}function V(e){if(!e)return"";var t=e.split("/");return t.pop(),t.join("/")}function G(e){return e?e.split("/").pop():""}function B(e,t,n){if(void 0===n&&(n="|"),f(e)){var r=e.split(n),i=r.pop();return i===t?[!0,r.toString()]:[!1,i]}return[!1,""]}function K(e,t){return!1===l(B(t,"static"),1)[0]&&e.config.reRenderOnLangChange}function z(e){return e?function(e){return e}:c.take(1)}function $(n,r){return Object.keys(n).reduce(function(e,t){return e[r+"/"+t]=n[t],e},{})}function q(e,t,n){if(n){if(!1===o(n[e]))throw"You're using an inline loader but didn't provide a loader for "+e;return n[e]().then(function(e){return e["default"]})}return t.getTranslation(e)}var J=(Object.defineProperty(W.prototype,"config",{get:function(){return this.mergedConfig},enumerable:!0,configurable:!0}),W.prototype.getDefaultLang=function(){return this.defaultLang},W.prototype.setDefaultLang=function(e){this.defaultLang=e},W.prototype.getActiveLang=function(){return this.lang.getValue()},W.prototype.setActiveLang=function(e){return this.lang.next(e),this},W.prototype.setAvailableLangs=function(e){this.availableLangs=e},W.prototype.getAvailableLangs=function(){return this.availableLangs},W.prototype.load=function(t,e){var n=this;if(void 0===e&&(e={}),!1===this.cache.has(t)){var r=void 0;if(this.useFallbackTranslation(t)){var i=this._isLangScoped(t)?V(t)+"/"+this.firstFallbackLang:this.firstFallbackLang,a=function l(e,t,n,r){return[e,t].map(function(t){var e=q(t,n,r);return p.from(e).pipe(c.map(function(e){return{translation:e,lang:t}}))})}(t,i,this.loader,e.inlineLoader);r=p.forkJoin(a)}else{var o=q(t,this.loader,e.inlineLoader);r=p.from(o)}var s=r.pipe(c.retry(this.config.failedRetries),c.catchError(function(){return n.handleFailure(t,e)}),c.tap(function(e){Array.isArray(e)?e.forEach(function(e){n.handleSuccess(e.lang,e.translation),e.lang!==t&&n.cache.set(e.lang,p.of({}))}):n.handleSuccess(t,e)}),c.shareReplay(1));this.cache.set(t,s)}return this.cache.get(t)},W.prototype.translate=function(e,t,n){var r=this;void 0===t&&(t={}),void 0===n&&(n=this.getActiveLang());var i,a=n;if(this._isLangScoped(n)){var o=G(n),s=this._isLang(o);a=s?o:this.getActiveLang(),i=this.getMappedScope(s?V(n):n)}if(Array.isArray(e))return e.map(function(e){return r.translate(i?i+"."+e:e,t,a)});if(!(e=i?i+"."+e:e))return this.missingHandler.handle(e,this.config);var l=this.getTranslation(a),c=l[e];return c?this.parser.transpile(c,t,l):this.handleMissingKey(e,c,t)},W.prototype.selectTranslate=function(t,n,e,r){var i=this;function a(e){return i.load(e).pipe(c.map(function(){return r?i.translateObject(t,n,e):i.translate(t,n,e)}))}if(void 0===r&&(r=!1),f(e)){var o=this._completeScopeWithLang(e);return a(o)}return this.langChanges$.pipe(c.switchMap(function(e){return a(e)}))},W.prototype.translateObject=function(e,t,n){var r=this;if(void 0===n&&(n=this.getActiveLang()),Array.isArray(e))return e.map(function(e){return r.translateObject(e,t,n)});var i=this.getTranslation(n),a=g(O(i),e);return this.parser.transpile(a,t,i)},W.prototype.selectTranslateObject=function(e,t,n){return this.selectTranslate(e,t,n,!0)},W.prototype.getTranslation=function(e){return e?this.translations.get(e)||{}:this.translations},W.prototype.selectTranslation=function(e){var t=this,n=e||this.getActiveLang();return this.load(n).pipe(c.map(function(){return t.getTranslation(n)}))},W.prototype.setTranslation=function(e,t,n){var r;void 0===t&&(t=this.getActiveLang()),void 0===n&&(n={});var i=u({},{merge:!0,emitChange:!0},n),a=V(t),o=e;a&&(o=C(((r={})[this.getMappedScope(a)]=e,r)));var s=a?G(t):t,l=u({},i.merge&&this.getTranslation(s),o),c=this.interceptor.preSaveTranslation(l,s),p=this.mergedConfig.flatten.aot?c:C(c);this.translations.set(s,p),i.emitChange&&this.setActiveLang(this.getActiveLang())},W.prototype.setTranslationKey=function(e,t,n){var r;void 0===n&&(n=this.getActiveLang());var i=this.interceptor.preSaveTranslationKey(e,t,n),a=u({},this.getTranslation(n),((r={})[e]=i,r));this.setTranslation(a,n)},W.prototype.handleMissingKey=function(e,t,n){if(this.config.missingHandler.allowEmpty&&""===t)return"";if(!this.useFallbackTranslation()||this.isResolvedMissingOnce)return this.missingHandler.handle(e,this.config);this.isResolvedMissingOnce=!0;var r=this.translate(e,n,this.firstFallbackLang);return this.isResolvedMissingOnce=!1,r},W.prototype._isLangScoped=function(e){return-1===this.getAvailableLangsIds().indexOf(e)},W.prototype._isLang=function(e){return-1!==this.getAvailableLangsIds().indexOf(e)},W.prototype._loadDependencies=function(e,t){var n=G(e);return this._isLangScoped(e)&&!this.isLoadedTranslation(n)?p.combineLatest(this.load(n),this.load(e,{inlineLoader:t})):this.load(e,{inlineLoader:t})},W.prototype.isLoadedTranslation=function(e){return a(this.getTranslation(e))},W.prototype._completeScopeWithLang=function(e){return this._isLangScoped(e)&&!this._isLang(G(e))?e+"/"+this.getActiveLang():e},W.prototype._setScopeAlias=function(e,t){this.mergedConfig.scopeMapping||(this.mergedConfig.scopeMapping={}),this.mergedConfig.scopeMapping[e]=t},W.prototype.getAvailableLangsIds=function(){return f(this.getAvailableLangs()[0])?this.getAvailableLangs():this.getAvailableLangs().map(function(e){return e.id})},W.prototype.useFallbackTranslation=function(e){return this.config.missingHandler.useFallbackTranslation&&e!==this.firstFallbackLang},W.prototype.handleSuccess=function(e,t){this.setTranslation(t,e,{emitChange:!1}),!1===this.failedLangs.has(e)?(this.events.next({wasFailure:!!this.failedLangs.size,type:"translationLoadSuccess",payload:{lang:e}}),this.failedCounter=0):(this.cache["delete"](e),this.failedLangs["delete"](e))},W.prototype.handleFailure=function(e,t){var n=e.split("/");this.failedLangs.add(e);var r=(t.fallbackLangs||this.fallbackStrategy.getNextLangs(e))[this.failedCounter],i=r===n[n.length-1];if(!r||i){var a="Unable to load translation and all the fallback languages";throw 1<n.length&&(a+=", did you misspelled the scope name?"),new Error(a)}var o=r;return 1<n.length&&(n[n.length-1]=r,o=n.join("/")),this.failedCounter++,this.events.next({type:"translationLoadFailure",payload:{lang:e}}),this.load(o)},W.prototype.setFallbackLangForMissingTranslation=function(e){var t=e.fallbackLang;this.useFallbackTranslation&&t&&(this.firstFallbackLang=Array.isArray(t)?t[0]:t)},W.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},W.prototype.getMappedScope=function(e){var t=this.config.scopeMapping;return(void 0===t?{}:t)[e]||y(e)},W.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],W.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Optional},{type:n.Inject,args:[i]}]},{type:undefined,decorators:[{type:n.Inject,args:[A]}]},{type:undefined,decorators:[{type:n.Inject,args:[k]}]},{type:undefined,decorators:[{type:n.Inject,args:[M]}]},{type:undefined,decorators:[{type:n.Inject,args:[j]}]},{type:undefined,decorators:[{type:n.Inject,args:[D]}]}]},W.ngInjectableDef=n.defineInjectable({factory:function(){return new W(n.inject(i,8),n.inject(A),n.inject(k),n.inject(M),n.inject(j),n.inject(D))},token:W,providedIn:"root"}),W);function W(e,t,n,r,i,a){var o=this;this.loader=e,this.parser=t,this.missingHandler=n,this.interceptor=r,this.userConfig=i,this.fallbackStrategy=a,this.translations=new Map,this.cache=new Map,this.firstFallbackLang=null,this.availableLangs=[],this.isResolvedMissingOnce=!1,this.events=new p.Subject,this.events$=this.events.asObservable(),this.failedCounter=0,this.failedLangs=new Set,this.loader||(this.loader=new d(this.translations)),(P=this).mergedConfig=function s(e,t){return u({},e,t,{missingHandler:u({},e.missingHandler,t.missingHandler),flatten:u({},e.flatten,t.flatten)})}(I,i),this.setAvailableLangs(this.mergedConfig.availableLangs),this.setFallbackLangForMissingTranslation(this.mergedConfig),this.setDefaultLang(this.mergedConfig.defaultLang),this.lang=new p.BehaviorSubject(this.getDefaultLang()),this.langChanges$=this.lang.asObservable(),this.subscription=this.events$.subscribe(function(e){if("translationLoadSuccess"===e.type&&e.wasFailure){var t=G(e.payload.lang);o.setActiveLang(t)}})}var Y=(U.decorators=[{type:n.Component,args:[{template:'\n    <div class="transloco-loader-template" [innerHTML]="html"></div>\n  '}]}],U.propDecorators={html:[{type:n.Input}]},U);function U(){}var Z=(Q.prototype.attachView=function(){if(this.view instanceof n.TemplateRef)this.vcr.createEmbeddedView(this.view);else if(f(this.view)){var e=this.createComponent(Y);e.instance.html=this.view,e.hostView.detectChanges()}else this.createComponent(this.view)},Q.prototype.detachView=function(){this.vcr.clear()},Q.prototype.createComponent=function(e){var t=this.injector.get(n.ComponentFactoryResolver).resolveComponentFactory(e);return this.vcr.createComponent(t)},Q);function Q(e,t){this.view=e,this.vcr=t,this.injector=this.vcr.injector}var X=new n.InjectionToken("TRANSLOCO_LANG"),ee=new n.InjectionToken("TRANSLOCO_LOADING_TEMPLATE"),te=new n.InjectionToken("TRANSLOCO_SCOPE"),ne=(re.prototype.resolve=function(e){var t=void 0===e?{inline:undefined,provider:undefined,active:undefined}:e,n=t.inline,r=t.provider,i=t.active,a=i;if(this.initialized)return a=i;if(r){var o=l(B(r,"static"),2);o[0],a=o[1]}if(n){var s=l(B(n,"static"),2);s[0],a=s[1]}return this.initialized=!0,a},re.prototype.resolveLangBasedOnScope=function(e){return V(e)?G(e):e},re.prototype.resolveLangPath=function(e,t){return t?t+"/"+e:e},re);function re(){this.initialized=!1}var ie=(ae.prototype.resolve=function(e){var t=void 0===e?{inline:undefined,provider:undefined}:e,n=t.inline,r=t.provider;if(n)return n;if(r){if(m(r)){var i=r,a=i.scope,o=i.alias,s=void 0===o?y(a):o;return this.translocoService._setScopeAlias(a,s),a}return r}return undefined},ae);function ae(e){this.translocoService=e}var oe=(se.prototype.ngOnInit=function(){var i=this,e=this.getLoadingTpl();e&&(this.loaderTplHandler=new Z(e,this.vcr),this.loaderTplHandler.attachView());var t=K(this.translocoService,this.providerLang||this.inlineLang);this.subscription=this.translocoService.langChanges$.pipe(c.switchMap(function(e){var t=i.langResolver.resolve({inline:i.inlineLang,provider:i.providerLang,active:e}),n=i.scopeResolver.resolve({inline:i.inlineScope,provider:i.providerScope});i.path=i.langResolver.resolveLangPath(t,n);var r=S(i.providerScope)?$(i.providerScope.loader,n):null;return i.translocoService._loadDependencies(i.path,r)}),z(t)).subscribe(function(){i.currentLang=i.langResolver.resolveLangBasedOnScope(i.path),null===i.tpl?i.simpleStrategy():i.structuralStrategy(i.currentLang,i.inlineRead),i.cdr.markForCheck(),i.initialized=!0})},se.prototype.ngOnChanges=function(t){Object.keys(t).some(function(e){return!1===t[e].firstChange})&&this.simpleStrategy()},se.prototype.simpleStrategy=function(){this.detachLoader(),this.host.nativeElement.innerText=this.translocoService.translate(this.key,this.params,this.currentLang)},se.prototype.structuralStrategy=function(e,t){this.translationMemo={},this.view?this.view.context.$implicit=this.getTranslateFn(e,t):(this.detachLoader(),this.view=this.vcr.createEmbeddedView(this.tpl,{$implicit:this.getTranslateFn(e,t)}))},se.prototype.getTranslateFn=function(i,a){var o=this;return function(e,t){var n=a?a+"."+e:e,r=t?""+n+JSON.stringify(t):n;return o.translationMemo.hasOwnProperty(r)||(o.translationMemo[r]={params:t,value:o.translocoService.translate(n,t,i)}),o.translationMemo[r].value}},se.prototype.getLoadingTpl=function(){return this.inlineTpl||this.providedLoadingTpl},se.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},se.prototype.detachLoader=function(){this.loaderTplHandler&&this.loaderTplHandler.detachView()},se.decorators=[{type:n.Directive,args:[{selector:"[transloco]"}]}],se.ctorParameters=function(){return[{type:J},{type:n.TemplateRef,decorators:[{type:n.Optional}]},{type:undefined,decorators:[{type:n.Optional},{type:n.Inject,args:[te]}]},{type:undefined,decorators:[{type:n.Optional},{type:n.Inject,args:[X]}]},{type:undefined,decorators:[{type:n.Optional},{type:n.Inject,args:[ee]}]},{type:n.ViewContainerRef},{type:n.ChangeDetectorRef},{type:n.ElementRef}]},se.propDecorators={key:[{type:n.Input,args:["transloco"]}],params:[{type:n.Input,args:["translocoParams"]}],inlineScope:[{type:n.Input,args:["translocoScope"]}],inlineRead:[{type:n.Input,args:["translocoRead"]}],inlineLang:[{type:n.Input,args:["translocoLang"]}],inlineTpl:[{type:n.Input,args:["translocoLoadingTpl"]}]},se);function se(e,t,n,r,i,a,o,s){this.translocoService=e,this.tpl=t,this.providerScope=n,this.providerLang=r,this.providedLoadingTpl=i,this.vcr=a,this.cdr=o,this.host=s,this.translationMemo={},this.params={},this.loaderTplHandler=null,this.initialized=!1,this.langResolver=new ne,this.scopeResolver=new ie(this.translocoService)}var le=(ce.prototype.transform=function(e,t,i){var a=this;if(!e)return e;var n=t?""+e+JSON.stringify(t):e;return n===this.lastKey||(this.lastKey=n,this.subscription&&this.subscription.unsubscribe(),this.subscription=this.translocoService.langChanges$.pipe(c.switchMap(function(e){var t=a.langResolver.resolve({inline:i,provider:a.providerLang,active:e}),n=a.scopeResolver.resolve({inline:undefined,provider:a.providerScope});a.path=a.langResolver.resolveLangPath(t,n);var r=S(a.providerScope)?$(a.providerScope.loader,n):null;return a.translocoService._loadDependencies(a.path,r)}),z(this.listenToLangChange)).subscribe(function(){return a.updateValue(e,t)})),this.lastValue},ce.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},ce.prototype.updateValue=function(e,t){var n=this.langResolver.resolveLangBasedOnScope(this.path);this.lastValue=this.translocoService.translate(e,t,n),this.cdr.markForCheck()},ce.decorators=[{type:n.Pipe,args:[{name:"transloco",pure:!1}]}],ce.ctorParameters=function(){return[{type:J},{type:undefined,decorators:[{type:n.Optional},{type:n.Inject,args:[te]}]},{type:undefined,decorators:[{type:n.Optional},{type:n.Inject,args:[X]}]},{type:n.ChangeDetectorRef}]},ce);function ce(e,t,n,r){this.translocoService=e,this.providerScope=t,this.providerLang=n,this.cdr=r,this.subscription=null,this.langResolver=new ne,this.scopeResolver=new ie(this.translocoService),this.listenToLangChange=K(this.translocoService,this.providerLang)}var pe=[{provide:A,useClass:w},{provide:k,useClass:N},{provide:M,useClass:F},{provide:D,useClass:x,deps:[j]}],ue=(de.decorators=[{type:n.NgModule,args:[{declarations:[oe,le,Y],providers:[pe],exports:[oe,le],entryComponents:[Y]}]}],de);function de(){}var ge=(he.prototype.getTranslation=function(e){return p.of(this.langs[e])},he.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Inject,args:["translocoLangs"]}]}]},he);function he(e){this.langs=e}var fe=(ve.withLangs=function(e,t){return void 0===t&&(t={}),{ngModule:ve,providers:[{provide:"translocoLangs",useValue:e},{provide:i,useClass:ge},pe,{provide:j,useValue:u({prodMode:!0},t)}]}},ve.decorators=[{type:n.NgModule,args:[{exports:[ue]}]}],ve);function ve(){}function ye(){if(!1===L())return undefined;var e=window.navigator,t=e.languages?e.languages[0]:null;return t=t||e.language||e.browserLanguage||e.userLanguage}e.translate=function Le(e,t,n){return void 0===t&&(t={}),P.translate(e,t,n)},e.TranslocoService=J,e.TranslocoDirective=oe,e.TranslocoPipe=le,e.TranslocoModule=ue,e.defaultProviders=pe,e.TRANSLOCO_LOADER=i,e.TRANSLOCO_CONFIG=j,e.defaultConfig=I,e.TRANSLOCO_TRANSPILER=A,e.DefaultTranspiler=w,e.TRANSLOCO_SCOPE=te,e.TRANSLOCO_LOADING_TEMPLATE=ee,e.TRANSLOCO_LANG=X,e.TestingLoader=ge,e.TranslocoTestingModule=fe,e.TemplateHandler=Z,e.TRANSLOCO_INTERCEPTOR=M,e.TRANSLOCO_FALLBACK_STRATEGY=D,e.DefaultFallbackStrategy=x,e.TRANSLOCO_MISSING_HANDLER=k,e.getBrowserCultureLang=ye,e.getBrowserLang=function be(){if(!1===L())return undefined;var e=ye();return-1!==e.indexOf("-")&&(e=e.split("-")[0]),-1!==e.indexOf("_")&&(e=e.split("_")[0]),e},e.getPipeValue=B,e.getLangFromScope=G,e.getScopeFromLang=V,e.getValue=g,e.setValue=h,e.size=a,e.isEmpty=function Te(e){return 0===a(e)},e.isFunction=o,e.isString=f,e.isNumber=s,e.isObject=v,e.coerceArray=function me(e){return Array.isArray(e)?e:[e]},e.toCamelCase=y,e.isBrowser=L,e.isNil=b,e.isDefined=T,e.toNumber=function Se(e){return s(e)?e:f(e)&&!isNaN(Number(e)-parseFloat(e))?Number(e):null},e.isScopeObject=m,e.hasInlineLoader=S,e.unflatten=O,e.flatten=C,e.ɵc=Y,e.ɵb=N,e.ɵa=F,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngneat-transloco.umd.min.js.map